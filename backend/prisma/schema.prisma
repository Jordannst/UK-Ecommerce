// Prisma Schema untuk UNKLAB E-Commerce Platform
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Model User untuk autentikasi dan manajemen user
model User {
  id        Int       @id @default(autoincrement())
  name      String
  email     String    @unique
  password  String
  role      String    @default("user") // "user" atau "admin"
  phone     String?
  address   String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  // Relations
  orders    Order[]
  cartItems CartItem[]
  wishlistItems WishlistItem[]
  
  @@map("users")
}

// Model Category untuk kategori produk
model Category {
  id          Int       @id @default(autoincrement())
  name        String
  slug        String    @unique
  description String?
  icon        String?
  image       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  // Relations
  products    Product[]
  
  @@map("categories")
}

// Model Product untuk produk yang dijual
model Product {
  id          Int       @id @default(autoincrement())
  name        String
  description String
  price       Float
  stock       Int       @default(0)
  image       String
  categoryId  Int
  faculty     String?   // Fakultas penjual (optional)
  ukm         String?   // UKM penjual (optional)
  seller      String?   // Nama penjual
  rating      Float?    @default(0)
  sold        Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  // Relations
  category    Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  cartItems   CartItem[]
  orderItems  OrderItem[]
  wishlistItems WishlistItem[]
  
  @@map("products")
}

// Model CartItem untuk item di keranjang
model CartItem {
  id        Int       @id @default(autoincrement())
  userId    Int
  productId Int
  quantity  Int       @default(1)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  // Relations
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  // Unique constraint: satu user hanya bisa punya satu item untuk satu produk
  @@unique([userId, productId])
  @@map("cart_items")
}

// Model Order untuk pesanan
model Order {
  id            Int         @id @default(autoincrement())
  userId        Int
  orderNumber   String      @unique
  status        String      @default("pending") // pending, processing, completed, cancelled
  totalAmount   Float
  paymentMethod String?
  
  // Shipping details
  shippingName    String
  shippingPhone   String
  shippingAddress String
  shippingCity    String?
  shippingZip     String?
  
  notes         String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  
  // Relations
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  orderItems    OrderItem[]
  
  @@map("orders")
}

// Model OrderItem untuk item dalam pesanan
model OrderItem {
  id          Int       @id @default(autoincrement())
  orderId     Int
  productId   Int
  productName String    // Simpan nama produk untuk history
  price       Float     // Simpan harga saat order
  quantity    Int
  subtotal    Float
  createdAt   DateTime  @default(now())
  
  // Relations
  order       Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product     Product   @relation(fields: [productId], references: [id], onDelete: Restrict)
  
  @@map("order_items")
}

// Model WishlistItem untuk wishlist user
model WishlistItem {
  id        Int       @id @default(autoincrement())
  userId    Int
  productId Int
  createdAt DateTime  @default(now())
  
  // Relations
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  // Unique constraint: satu user hanya bisa wishlist satu produk sekali
  @@unique([userId, productId])
  @@map("wishlist_items")
}
